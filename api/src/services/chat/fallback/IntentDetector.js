const Utils = require('./Utils');class IntentDetector {    detectIntent(message) {        const cleanedMessage = message.replace(/[\u{1F300}-\u{1F9FF}]/gu, '').trim();        const lower = cleanedMessage.toLowerCase().trim();        const normalized = Utils.normalizeVietnamese(lower);        const branchQuestionPatterns = [            /(bạn|ban)\s*(có|co)\s*(những|nhung|những|nhiều|nhieu)\s*(chi nhánh|chi nhanh|branch|nhà hàng|nha hang)\s*(nào|nao|gì|gi|vậy|vay)/i,            /(có|co)\s+(những|nhung|những|nhiều|nhieu)\s*(chi nhánh|chi nhanh|branch|nhà hàng|nha hang)\s*(nào|nao|gì|gi|vậy|vay)/i,            /(chi nhánh|chi nhanh|branch|nhà hàng|nha hang)\s*(nào|nao|gì|gi|những|nhung|nhiều|nhieu|vậy|vay)/i,            /(những|nhung|những|nhiều|nhieu)\s*(chi nhánh|chi nhanh|branch|nhà hàng|nha hang)\s*(nào|nao|gì|gi|vậy|vay)/i,            /(bạn|ban|bạn có|ban co)\s*(có|co)\s*(những|nhung|những|nhiều|nhieu|những|nhung)\s*(chi nhánh|chi nhanh|branch|nhà hàng|nha hang)/i,            /(danh sách|danh sach|list|liệt kê|liet ke)\s*(chi nhánh|chi nhanh|branch|nhà hàng|nha hang)/i,        ];        for (const pattern of branchQuestionPatterns) {            if (lower.match(pattern) || normalized.match(pattern)) {                return 'ask_branch';            }        }        const foodQuestionPatterns = [            /(có|co)\s+([^không|khong]+?)\s+(không|khong)/i,            /(nhà hàng|nha hang|restaurant)\s+(có|co)\s+([^không|khong]+?)\s+(không|khong)/i,            /(có|co)\s+(món|mon|dish)\s+([^không|khong]+?)\s+(không|khong)/i,            /(có|co)\s+([^không|khong]+?)\s+(không|khong)\s+(có|co)/i,        ];        for (const pattern of foodQuestionPatterns) {            if (lower.match(pattern) || normalized.match(pattern)) {                return 'search_food';            }        }        if (lower.match(/(tìm|tim|search|tìm kiếm|tim kiem)\s+(món|mon|food|đồ ăn|do an)/i) ||            normalized.match(/(tim|search|tim kiem)\s+(mon|food|do an)/i)) {            return 'search_food';        }        const isAffirmative = /\b(ok|oke|okay|okie|okey|dong y|đồng ý|yes|y|chuẩn|chuan|dung roi|đúng rồi|đúng|dung|xác nhận|xac nhan|confirm|được|duoc|tốt|tot|hay|ổn|on|chắc chắn|chac chan|tất nhiên|tat nhien)\b/i;        if ((isAffirmative.test(lower) || isAffirmative.test(normalized) || isAffirmative.test(message)) &&            !lower.match(/(có|co)\s+.*\s+(không|khong)/i) &&            !normalized.match(/(co)\s+.*\s+(khong)/i)) {            return 'confirm_booking';        }        const bookingPatterns = [            /(đặt bàn|book|reservation|chỗ ngồi|đặt chỗ|muốn đặt bàn|tôi muốn đặt bàn|dat ban|book|reservation|cho ngoi|dat cho|muon dat ban|toi muon dat ban)/i,            /(\d+)\s*(nguoi|người|people|person|pax).*(đặt bàn|book|reservation|dat ban|book|reservation)/i,            /(đặt bàn|book|reservation|dat ban|book|reservation).*(\d+)\s*(nguoi|người|people|person|pax)/i,            /(\d+)\s*(nguoi|người|people|person|pax).*(\d{1,2})[h:]\s*(\d{0,2})?\s*(am|pm)?/i,            /(\d{1,2})[h:]\s*(\d{0,2})?\s*(am|pm)?.*(\d+)\s*(nguoi|người|people|person|pax)/i        ];        for (const pattern of bookingPatterns) {            if (lower.match(pattern) || normalized.match(pattern)) {                return 'book_table';            }        }        if (lower.match(/(chi nhánh đầu tiên|đầu tiên|đầu|first|first branch)/i) ||             normalized.match(/(chi nhanh dau tien|dau tien|dau|first|first branch)/i)) {            return 'find_first_branch';        }        if (lower.match(/(nhi nhanh dau tien|nhi nhanh dau|nhi nhanh)/i) ||            normalized.match(/(nhi nhanh dau tien|nhi nhanh dau|nhi nhanh)/i)) {            return 'find_first_branch';        }        if (lower.match(/(xem menu|menu|thực đơn|menu của|menu cua)\s+(?:chi nhánh|chi nhanh|branch|nhà hàng|nha hang)?\s*(.+)/i) ||             normalized.match(/(xem menu|menu|thuc don|menu cua)\s+(?:chi nhanh|branch|nha hang)?\s*(.+)/i) ||            lower.match(/(xem menu|menu)\s+([a-z]+)/i)) {            return 'view_menu_specific_branch';        }        if (lower.match(/(đặt món|order|gọi món|mua|chọn món)\s+(?:chi nhánh|chi nhanh|branch|nhà hàng|nha hang)?\s*(.+)/i) ||             normalized.match(/(dat mon|order|goi mon|mua|chon mon)\s+(?:chi nhanh|branch|nha hang)?\s*(.+)/i)) {            return 'order_food_specific_branch';        }        if (lower.match(/(đặt bàn|book|reservation|chỗ ngồi|đặt chỗ)\s+(?:chi nhánh|chi nhanh|branch|nhà hàng|nha hang)?\s*(.+)/i) ||             normalized.match(/(dat ban|book|reservation|cho ngoi|dat cho)\s+(?:chi nhanh|branch|nha hang)?\s*(.+)/i)) {            return 'book_table_specific_branch';        }        if (lower.match(/(xem chi nhánh|xem chi nhanh|view branch|view branches|xem tất cả chi nhánh|xem tat ca chi nhanh)/i) ||             normalized.match(/(xem chi nhanh|view branch|view branches|xem tat ca chi nhanh)/i)) {            return 'view_branches';        }        if (lower.match(/(chi nhánh nào|chi nhanh nao|chi nhánh|chi nhanh|branch|nhà hàng|nha hang|bạn có chi nhánh|ban co chi nhanh)/i) ||             normalized.match(/(chi nhanh nao|chi nhanh|branch|nha hang|ban co chi nhanh)/i)) {            return 'ask_branch';        }        if (lower.match(/(menu|món|danh sách|có gì|xem món|thực đơn)/i) ||             normalized.match(/(menu|mon|danh sach|co gi|xem mon|thuc don)/i)) {            return 'view_menu';        }        if (lower.match(/(tìm món|tim mon|search|tìm kiếm|tim kiem|món nào|mon nao|có món|có món gì|co mon|co mon gi|có.*không|co.*khong|tìm.*\w+|tim.*\w+)/i) ||             normalized.match(/(tim mon|search|tim kiem|mon nao|co mon|co mon gi|co.*khong|tim.*\w+)/i)) {            return 'search_food';        }        if (lower.match(/(chi nhánh gần nhất|gần nhất|gần tôi|nearest|closest|chi nhanh gan nhat|gan nhat|gan toi)/i) ||             normalized.match(/(chi nhanh gan nhat|gan nhat|gan toi|nearest|closest)/i)) {            return 'find_nearest_branch';        }        if (lower.match(/(giao hàng|giao hang|delivery|đặt đơn giao|dat don giao)/i) ||             normalized.match(/(giao hang|delivery|dat don giao)/i)) {            return 'order_delivery';        }        if (lower.match(/(đặt đơn|dat don|đặt món mang về|dat mon mang ve|takeaway|mang về|mang ve)/i) ||             normalized.match(/(dat don|dat mon mang ve|takeaway|mang ve)/i)) {            return 'order_takeaway';        }        if (lower.match(/(đặt món|order|gọi món|mua|chọn món)/i) ||             normalized.match(/(dat mon|order|goi mon|mua|chon mon)/i)) {            return 'order_food';        }        if (lower.match(/(đặt bàn|book|reservation|chỗ ngồi|đặt chỗ|muốn đặt bàn|tôi muốn đặt bàn)/i) ||             normalized.match(/(dat ban|book|reservation|cho ngoi|dat cho|muon dat ban|toi muon dat ban)/i)) {            return 'book_table';        }        if (lower.match(/(đơn hàng|order|lịch sử|đơn của tôi)/i) ||             normalized.match(/(don hang|order|lich su|don cua toi)/i)) {            return 'view_orders';        }        if (lower.match(/(gửi lại|gui lai|gửi lại thông tin|gui lai thong tin|thông tin đặt bàn|thong tin dat ban|thông tin đơn|thong tin don)/i) ||             normalized.match(/(gui lai|gui lai thong tin|thong tin dat ban|thong tin don)/i)) {            return 'show_booking_info';        }        return 'ask_info';    }}module.exports = new IntentDetector();