const USER_ROLES = {    CUSTOMER: 'customer',    GUEST: 'guest',    STAFF: 'staff',    MANAGER: 'manager',    ADMIN: 'admin'};const TOOL_DEFINITIONS = [    {        name: 'get_branch_menu',        description: 'Lấy menu món ăn của một chi nhánh cụ thể với giá và tình trạng còn hàng. ⚠️ QUAN TRỌNG CỰC KỲ: Dùng tool này khi khách hỏi "xem menu của chi nhánh X", "menu chi nhánh Y", "thực đơn chi nhánh Z", "toi muon xem menu cua CHI NHANH [tên chi nhánh]", "menu cua quan an", "menu cua nha hang". Nếu chưa có branch_id, BẮT BUỘC phải: (1) Gọi get_all_branches() để lấy danh sách chi nhánh, (2) Tìm branch_id từ tên chi nhánh (fuzzy match), (3) Gọi get_branch_menu với branch_id đó. TUYỆT ĐỐI KHÔNG chỉ gọi get_all_branches() và trả về danh sách chi nhánh khi user hỏi về menu! Nếu user hỏi "xem menu" (không có tên chi nhánh), mới được gọi get_all_branches() để hiển thị danh sách chi nhánh.',        allowed_roles: [USER_ROLES.CUSTOMER, USER_ROLES.GUEST, USER_ROLES.STAFF, USER_ROLES.MANAGER],        parameters: {            type: 'object',            properties: {                branch_id: {                    type: 'integer',                    description: 'ID của chi nhánh cần xem menu. QUAN TRỌNG: Nếu user hỏi "menu chi nhánh X" nhưng chưa có branch_id, cần tìm branch_id từ tên chi nhánh trước (có thể dùng get_all_branches để tìm, sau đó extract branch_id từ kết quả)'                },                category_id: {                    type: 'integer',                    description: 'Lọc theo danh mục món ăn (optional). Ví dụ: 1=Khai vị, 2=Món chính, 3=Tráng miệng',                    nullable: true                }            },            required: ['branch_id']        },        handler: 'ToolHandlers.getBranchMenu',        inject_user_context: false,        require_auth: false    },    {        name: 'search_products',        description: 'Tìm kiếm món ăn theo tên, mô tả, giá, danh mục, hoặc dietary preferences. Dùng khi khách hỏi "có món X không", "tìm món Y", "món chay", "món dưới 100k", "món bò ngon nhất"',        allowed_roles: [USER_ROLES.CUSTOMER, USER_ROLES.GUEST, USER_ROLES.STAFF, USER_ROLES.MANAGER],        parameters: {            type: 'object',            properties: {                keyword: {                    type: 'string',                    description: 'Từ khóa tìm kiếm món ăn (tên món, mô tả, nguyên liệu)',                    nullable: true                },                category_id: {                    type: 'integer',                    description: 'Lọc theo danh mục món ăn (optional). Ví dụ: 1=Khai vị, 2=Món chính, 3=Tráng miệng',                    nullable: true                },                min_price: {                    type: 'number',                    description: 'Giá tối thiểu (VND)',                    nullable: true,                    minimum: 0                },                max_price: {                    type: 'number',                    description: 'Giá tối đa (VND). Ví dụ: 100000 cho "món dưới 100k"',                    nullable: true,                    minimum: 0                },                branch_id: {                    type: 'integer',                    description: 'Lọc theo chi nhánh cụ thể (optional)',                    nullable: true                },                sort_by: {                    type: 'string',                    enum: ['price_asc', 'price_desc', 'name', 'popularity'],                    description: 'Sắp xếp kết quả: price_asc (giá thấp->cao), price_desc (giá cao->thấp), name (tên A-Z), popularity (phổ biến nhất)',                    nullable: true                },                dietary: {                    type: 'string',                    enum: ['vegetarian', 'vegan', 'halal', 'seafood', 'meat', 'chicken', 'beef', 'pork'],                    description: 'Lọc theo chế độ ăn hoặc loại thực phẩm: vegetarian (chay), vegan (thuần chay), halal, seafood (hải sản), meat (thịt), chicken (gà), beef (bò), pork (heo)',                    nullable: true                },                limit: {                    type: 'integer',                    description: 'Số lượng kết quả tối đa',                    default: 10,                    minimum: 1,                    maximum: 50                }            },            required: []        },        handler: 'ToolHandlers.searchProducts',        inject_user_context: false,        require_auth: false    },    {        name: 'check_table_availability',        description: 'Kiểm tra bàn trống tại chi nhánh vào thời gian cụ thể. Dùng khi khách hỏi "còn bàn không", "đặt bàn được không"',        allowed_roles: [USER_ROLES.CUSTOMER, USER_ROLES.GUEST, USER_ROLES.STAFF, USER_ROLES.MANAGER],        parameters: {            type: 'object',            properties: {                branch_id: {                    type: 'integer',                    description: 'ID chi nhánh cần kiểm tra'                },                reservation_date: {                    type: 'string',                    format: 'date',                    description: 'Ngày đặt bàn (YYYY-MM-DD). Ví dụ: 2024-01-20'                },                reservation_time: {                    type: 'string',                    pattern: '^([0-1][0-9]|2[0-3]):[0-5][0-9]$',                    description: 'Giờ đặt bàn (HH:MM). Ví dụ: 19:00'                },                guest_count: {                    type: 'integer',                    minimum: 1,                    maximum: 50,                    description: 'Số lượng khách (1-50 người)'                }            },            required: ['branch_id', 'reservation_date', 'reservation_time', 'guest_count']        },        handler: 'ToolHandlers.checkTableAvailability',        inject_user_context: false,        require_auth: false    },    {        name: 'create_reservation',        description: 'Tạo đặt bàn mới cho khách hàng. CHỈ gọi sau khi đã kiểm tra bàn trống và khách xác nhận đặt',        allowed_roles: [USER_ROLES.CUSTOMER, USER_ROLES.STAFF, USER_ROLES.MANAGER],        parameters: {            type: 'object',            properties: {                branch_id: {                    type: 'integer',                    description: 'ID chi nhánh'                },                reservation_date: {                    type: 'string',                    format: 'date',                    description: 'Ngày đặt bàn (YYYY-MM-DD)'                },                reservation_time: {                    type: 'string',                    description: 'Giờ đặt bàn (HH:MM)'                },                guest_count: {                    type: 'integer',                    minimum: 1,                    description: 'Số khách'                },                special_requests: {                    type: 'string',                    description: 'Yêu cầu đặc biệt (optional)',                    nullable: true                },                customer_name: {                    type: 'string',                    description: 'Tên khách (nếu không đăng nhập)',                    nullable: true                },                customer_phone: {                    type: 'string',                    description: 'Số điện thoại (nếu không đăng nhập)',                    nullable: true                }            },            required: ['branch_id', 'reservation_date', 'reservation_time', 'guest_count']        },        handler: 'ToolHandlers.createReservation',        inject_user_context: true,        require_auth: false     },    {        name: 'get_my_reservations',        description: 'Lấy danh sách đặt bàn của khách hàng hiện tại. Dùng khi khách hỏi "đặt bàn của tôi", "xem reservation"',        allowed_roles: [USER_ROLES.CUSTOMER],        parameters: {            type: 'object',            properties: {                status: {                    type: 'string',                    enum: ['pending', 'confirmed', 'completed', 'cancelled'],                    description: 'Lọc theo trạng thái',                    nullable: true                },                limit: {                    type: 'integer',                    default: 10,                    description: 'Số lượng kết quả'                }            }        },        handler: 'ToolHandlers.getMyReservations',        inject_user_context: true,        require_auth: true    },    {        name: 'get_my_orders',        description: 'Lấy danh sách đơn hàng của khách hàng hiện tại. Dùng khi khách hỏi "đơn hàng của tôi", "order history"',        allowed_roles: [USER_ROLES.CUSTOMER],        parameters: {            type: 'object',            properties: {                status: {                    type: 'string',                    enum: ['pending', 'confirmed', 'preparing', 'ready', 'completed', 'cancelled'],                    description: 'Lọc theo trạng thái đơn hàng',                    nullable: true                },                limit: {                    type: 'integer',                    default: 10,                    description: 'Số lượng đơn hàng'                }            }        },        handler: 'ToolHandlers.getMyOrders',        inject_user_context: true,        require_auth: true    },    {        name: 'get_all_branches',        description: 'Lấy danh sách tất cả chi nhánh đang hoạt động với thông tin chi tiết. Dùng khi khách hỏi "có những chi nhánh nào", "danh sách chi nhánh", "đặt đơn takeaway", "đặt món mang về", "giao hàng", "takeaway", "delivery". QUAN TRỌNG: Khi khách muốn đặt đơn takeaway/mang về, BẮT BUỘC phải gọi tool này để lấy danh sách chi nhánh cho khách chọn.',        allowed_roles: [USER_ROLES.CUSTOMER, USER_ROLES.GUEST, USER_ROLES.STAFF, USER_ROLES.MANAGER],        parameters: {            type: 'object',            properties: {                district_id: {                    type: 'integer',                    description: 'Lọc theo quận/huyện (optional)',                    nullable: true                },                province_id: {                    type: 'integer',                    description: 'Lọc theo tỉnh/thành phố (optional)',                    nullable: true                }            }        },        handler: 'ToolHandlers.getAllBranches',        inject_user_context: false,        require_auth: false    },    {        name: 'get_branch_details',        description: 'Lấy thông tin chi tiết của một chi nhánh cụ thể (địa chỉ, giờ mở cửa, số điện thoại)',        allowed_roles: [USER_ROLES.CUSTOMER, USER_ROLES.GUEST, USER_ROLES.STAFF, USER_ROLES.MANAGER],        parameters: {            type: 'object',            properties: {                branch_id: {                    type: 'integer',                    description: 'ID chi nhánh'                }            },            required: ['branch_id']        },        handler: 'ToolHandlers.getBranchDetails',        inject_user_context: false,        require_auth: false    },    {        name: 'get_product_details',        description: 'Lấy thông tin chi tiết của một món ăn (mô tả, giá, options, reviews)',        allowed_roles: [USER_ROLES.CUSTOMER, USER_ROLES.GUEST, USER_ROLES.STAFF, USER_ROLES.MANAGER],        parameters: {            type: 'object',            properties: {                product_id: {                    type: 'integer',                    description: 'ID món ăn'                },                branch_id: {                    type: 'integer',                    description: 'ID chi nhánh (để lấy giá theo chi nhánh)',                    nullable: true                }            },            required: ['product_id']        },        handler: 'ToolHandlers.getProductDetails',        inject_user_context: false,        require_auth: false    },    {        name: 'get_categories',        description: 'Lấy danh sách các danh mục món ăn (Khai vị, Món chính, Tráng miệng, etc.)',        allowed_roles: [USER_ROLES.CUSTOMER, USER_ROLES.GUEST, USER_ROLES.STAFF, USER_ROLES.MANAGER],        parameters: {            type: 'object',            properties: {}        },        handler: 'ToolHandlers.getCategories',        inject_user_context: false,        require_auth: false    },    {        name: 'check_branch_operating_hours',        description: 'Kiểm tra xem chi nhánh có mở cửa vào thời gian cụ thể không',        allowed_roles: [USER_ROLES.CUSTOMER, USER_ROLES.GUEST, USER_ROLES.STAFF, USER_ROLES.MANAGER],        parameters: {            type: 'object',            properties: {                branch_id: {                    type: 'integer',                    description: 'ID chi nhánh'                },                check_time: {                    type: 'string',                    description: 'Thời gian cần kiểm tra (HH:MM)',                    nullable: true                }            },            required: ['branch_id']        },        handler: 'ToolHandlers.checkBranchOperatingHours',        inject_user_context: false,        require_auth: false    },    {        name: 'get_revenue_report',        description: '⛔ Báo cáo doanh thu theo chi nhánh và khoảng thời gian - CHỈ ADMIN/MANAGER',        allowed_roles: [USER_ROLES.MANAGER, USER_ROLES.ADMIN],        parameters: {            type: 'object',            properties: {                branch_id: {                    type: 'integer',                    description: 'ID chi nhánh (null = tất cả chi nhánh)',                    nullable: true                },                start_date: {                    type: 'string',                    format: 'date',                    description: 'Ngày bắt đầu (YYYY-MM-DD)'                },                end_date: {                    type: 'string',                    format: 'date',                    description: 'Ngày kết thúc (YYYY-MM-DD)'                }            },            required: ['start_date', 'end_date']        },        handler: 'ToolHandlers.getRevenueReport',        inject_user_context: true,        require_auth: true,        audit_log: true    },    {        name: 'get_all_users',        description: '⛔ Lấy danh sách users - CHỈ ADMIN',        allowed_roles: [USER_ROLES.ADMIN],        parameters: {            type: 'object',            properties: {                role: {                    type: 'string',                    enum: ['customer', 'staff', 'manager', 'admin'],                    nullable: true                },                limit: {                    type: 'integer',                    default: 50                }            }        },        handler: 'ToolHandlers.getAllUsers',        inject_user_context: true,        require_auth: true,        audit_log: true    },    {        name: 'get_all_reservations',        description: '⛔ Xem tất cả đặt bàn trong hệ thống - CHỈ MANAGER/ADMIN',        allowed_roles: [USER_ROLES.MANAGER, USER_ROLES.ADMIN],        parameters: {            type: 'object',            properties: {                branch_id: {                    type: 'integer',                    nullable: true                },                date: {                    type: 'string',                    format: 'date',                    nullable: true                },                status: {                    type: 'string',                    nullable: true                }            }        },        handler: 'ToolHandlers.getAllReservations',        inject_user_context: true,        require_auth: true,        audit_log: true    }];function getToolDefinitionsForLLM(userRole = USER_ROLES.GUEST) {    return TOOL_DEFINITIONS        .filter(tool => tool.allowed_roles.includes(userRole))        .map(tool => ({            type: 'function',            function: {                name: tool.name,                description: tool.description,                parameters: tool.parameters            }        }));}function getToolByName(toolName) {    return TOOL_DEFINITIONS.find(t => t.name === toolName);}module.exports = {    TOOL_DEFINITIONS,    USER_ROLES,    getToolDefinitionsForLLM,    getToolByName};