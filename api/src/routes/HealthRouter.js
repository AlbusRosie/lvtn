const express = require('express');const AnalyticsService = require('../services/chat/AnalyticsService');const { ErrorHandler } = require('../utils/ErrorHandler');const router = express.Router();module.exports.setup = (app) => {    app.use('/api', router);    router.get('/health', async (req, res) => {        try {            const health = await AnalyticsService.healthCheck();            res.status(health.status === 'healthy' ? 200 : 503).json(health);        } catch (error) {            res.status(503).json({                status: 'unhealthy',                error: error.message,                timestamp: new Date().toISOString()            });        }    });    router.get('/metrics', async (req, res, next) => {        try {            const authHeader = req.headers.authorization;            if (!authHeader || !authHeader.startsWith('Bearer ')) {                return res.status(401).json({ error: 'Unauthorized' });            }            const metrics = AnalyticsService.getCurrentMetrics();            res.json({                status: 'success',                data: metrics            });        } catch (error) {            next(error);        }    });    router.get('/analytics/dashboard', async (req, res, next) => {        try {            const { start_date, end_date } = req.query;            if (!start_date || !end_date) {                return res.status(400).json({                    error: 'start_date and end_date are required'                });            }            const [                conversationMetrics,                toolUsageStats,                intentDistribution,                responseTimeMetrics,                bookingConversionRate            ] = await Promise.all([                AnalyticsService.getConversationMetrics(start_date, end_date),                AnalyticsService.getToolUsageStats(10),                AnalyticsService.getIntentDistribution(start_date, end_date),                AnalyticsService.getResponseTimeMetrics(start_date, end_date),                AnalyticsService.getBookingConversionRate(start_date, end_date)            ]);            res.json({                status: 'success',                data: {                    period: { start_date, end_date },                    conversationMetrics,                    toolUsageStats,                    intentDistribution,                    responseTimeMetrics,                    bookingConversionRate                }            });        } catch (error) {            next(error);        }    });};