<template>  <div class="invoice-view">    <div class="invoice-header">      <div class="invoice-info">        <h3>INVOICE</h3>        <p class="invoice-number">Invoice ID: #{{ invoice.id }}</p>        <p class="invoice-date">{{ formatDate(invoice.created_at) }}</p>      </div>      <div class="invoice-status">        <span :class="['status-badge', invoice.payment_status === 'paid' ? 'paid' : 'unpaid']">          {{ invoice.payment_status === 'paid' ? 'Paid' : 'Unpaid' }}        </span>      </div>    </div>    <div class="invoice-body">      <div class="customer-info">        <h4>Customer information</h4>        <p><strong>Name:</strong> {{ displayCustomerName }}</p>        <p v-if="displayCustomerPhone"><strong>Phone:</strong> {{ displayCustomerPhone }}</p>        <p v-if="displayTableId"><strong>Table:</strong> #{{ displayTableId }}</p>        <p><strong>Order type:</strong> {{ getOrderTypeLabel(displayOrderType) }}</p>      </div>      <div class="invoice-items">        <h4>Product details</h4>        <table class="items-table">          <thead>            <tr>              <th>No.</th>              <th>Product</th>              <th>Unit price</th>              <th>Quantity</th>              <th>Total</th>            </tr>          </thead>          <tbody>            <tr v-for="(item, index) in displayItems" :key="item.id || index">              <td>{{ index + 1 }}</td>              <td>                <div class="product-name">{{ item.product_name || item.name }}</div>                <div v-if="getFormattedOptions(item.special_instructions)" class="product-options">                  {{ getFormattedOptions(item.special_instructions) }}                </div>              </td>              <td>{{ formatCurrency(item.price) }}</td>              <td>{{ item.quantity }}</td>              <td>{{ formatCurrency(item.price * item.quantity) }}</td>            </tr>          </tbody>        </table>      </div>      <div class="invoice-summary">        <div class="summary-row">          <span>Subtotal:</span>          <span>{{ formatCurrency(invoice.subtotal || invoice.total) }}</span>        </div>        <div v-if="invoice.discount" class="summary-row">          <span>Discount:</span>          <span class="discount">-{{ formatCurrency(invoice.discount) }}</span>        </div>        <div class="summary-row total">          <span>Total:</span>          <span>{{ formatCurrency(invoice.total) }}</span>        </div>        <div v-if="invoice.payment_method" class="summary-row">          <span>Payment method:</span>          <span>{{ getPaymentMethodLabel(invoice.payment_method) }}</span>        </div>      </div>      <div v-if="invoice.notes" class="invoice-notes">        <h4>Notes</h4>        <p>{{ invoice.notes }}</p>      </div>    </div>    <div class="invoice-footer">      <p>Thank you for using our service!</p>      <p class="footer-note">Electronic invoice - Legally valid</p>    </div>  </div></template><script setup>import { ref, computed, onMounted } from 'vue';import { useToast } from 'vue-toastification';import OrderService from '@/services/OrderService';const props = defineProps({  invoice: {    type: Object,    required: true  }});const toast = useToast();const loading = ref(false);const invoiceData = ref(null);const displayItems = computed(() => {  if (invoiceData.value && invoiceData.value.items) {    return invoiceData.value.items;  }  if (props.invoice && props.invoice.items) {    return props.invoice.items;  }  return [];});const displayCustomerName = computed(() => {  return invoiceData.value?.customer_name || props.invoice?.customer_name || 'Walk-in customer';});const displayCustomerPhone = computed(() => {  return invoiceData.value?.customer_phone || props.invoice?.customer_phone || null;});const displayTableId = computed(() => {  return invoiceData.value?.table_id || props.invoice?.table_id || null;});const displayOrderType = computed(() => {  return invoiceData.value?.order_type || props.invoice?.order_type || 'dine_in';});async function loadInvoiceDetails() {  if (!props.invoice.id) return;  loading.value = true;  try {    const data = await OrderService.getOrderById(props.invoice.id);    invoiceData.value = data;  } catch (error) {    toast.error('Failed to load invoice details');  } finally {    loading.value = false;  }}function formatCurrency(amount) {  return new Intl.NumberFormat('vi-VN', {    style: 'currency',    currency: 'VND'  }).format(amount);}function formatDate(dateString) {  return new Date(dateString).toLocaleString('vi-VN');}  function getOrderTypeLabel(type) {    const labels = {      dine_in: 'Dine-in',      takeaway: 'Takeaway',      delivery: 'Delivery'    };    return labels[type] || type;  }  function getPaymentMethodLabel(method) {    const labels = {      cash: 'Cash',      card: 'Card',      bank_transfer: 'Bank transfer',      e_wallet: 'E-wallet'    };    return labels[method] || method;  }function isJsonString(str) {  if (typeof str !== 'string') return false;  try {    const parsed = JSON.parse(str);    return Array.isArray(parsed) && parsed.length > 0 && parsed[0].option_name;  } catch (e) {    return false;  }}function getFormattedOptions(specialInstructions) {  if (!specialInstructions) return '';  if (typeof specialInstructions === 'string') {    if (isJsonString(specialInstructions)) {      try {        const options = JSON.parse(specialInstructions);        if (Array.isArray(options)) {          return options.map(option => {            const optionName = option.option_name || '';            const selectedValues = option.selected_values || [];            const valuesText = selectedValues.join(', ');            return optionName + ': ' + valuesText;          }).join(' | ');        }      } catch (e) {        return specialInstructions;      }    } else {      return specialInstructions;    }  }  if (Array.isArray(specialInstructions)) {    return specialInstructions.map(option => {      const optionName = option.option_name || '';      const selectedValues = option.selected_values || [];      const valuesText = selectedValues.join(', ');      return optionName + ': ' + valuesText;    }).join(' | ');  }  if (typeof specialInstructions === 'object') {    const optionName = specialInstructions.option_name || '';    const selectedValues = specialInstructions.selected_values || [];    const valuesText = selectedValues.join(', ');    return optionName + ': ' + valuesText;  }  return '';}onMounted(() => {  if (props.invoice && props.invoice.id) {    loadInvoiceDetails();  }});</script><style scoped>.invoice-view {  max-width: 800px;  margin: 0 auto;  background: white;  padding: 40px;}.invoice-header {  text-align: center;  margin-bottom: 32px;  padding-bottom: 24px;  border-bottom: 2px solid #E2E8F0;}.invoice-header h3 {  font-size: 28px;  margin: 0 0 12px 0;  color: #333;  text-transform: uppercase;}.invoice-number {  font-size: 18px;  font-weight: 600;  color: #333;  margin: 8px 0;}.invoice-date {  color: #666;  font-size: 14px;  margin: 0;}.status-badge {  display: inline-block;  padding: 6px 12px;  border-radius: 12px;  font-size: 12px;  font-weight: 500;}.status-badge.paid {  background: #D4EDDA;  color: #155724;}.status-badge.unpaid {  background: #F8D7DA;  color: #721C24;}.invoice-body {  margin-bottom: 32px;}.customer-info {  margin-bottom: 24px;  padding: 16px;  background: #F8F9FA;  border-radius: 8px;}.customer-info h4 {  font-size: 16px;  margin: 0 0 12px 0;  color: #333;}.customer-info p {  margin: 6px 0;  font-size: 14px;  color: #666;}.invoice-items {  margin-bottom: 24px;}.invoice-items h4 {  font-size: 16px;  margin-bottom: 12px;  color: #333;}.items-table {  width: 100%;  border-collapse: collapse;}.items-table th,.items-table td {  padding: 12px;  text-align: left;  border-bottom: 1px solid #E2E8F0;}.items-table th {  background: #F8F9FA;  font-weight: 600;  color: #333;}.items-table td {  text-align: right;}.items-table td:nth-child(2) {  text-align: left;}.product-name {  font-weight: 500;  color: #333;  margin-bottom: 4px;}.product-options {  font-size: 12px;  color: #666;  font-style: italic;  margin-top: 4px;  padding-left: 8px;}.invoice-summary {  background: #F8F9FA;  padding: 20px;  border-radius: 8px;  margin-bottom: 24px;}.summary-row {  display: flex;  justify-content: space-between;  margin-bottom: 8px;  font-size: 14px;}.summary-row.total {  font-size: 20px;  font-weight: 600;  color: #333;  margin-top: 12px;  padding-top: 12px;  border-top: 2px solid #E2E8F0;}.discount {  color: #28A745;}.invoice-notes {  margin-bottom: 24px;  padding: 16px;  background: #F8F9FA;  border-radius: 8px;}.invoice-notes h4 {  font-size: 16px;  margin-bottom: 8px;  color: #333;}.invoice-notes p {  margin: 0;  color: #666;  font-size: 14px;}.invoice-footer {  text-align: center;  padding-top: 24px;  border-top: 2px solid #E2E8F0;}.invoice-footer p {  margin: 8px 0;  color: #666;  font-size: 14px;}.footer-note {  font-size: 12px;  color: #999;  font-style: italic;}@media print {  .invoice-view {    padding: 20px;  }  .invoice-header,  .invoice-footer {    page-break-inside: avoid;  }}</style>