<template>  <div class="create-order-form">    <form @submit.prevent="submitOrder">      <div class="form-section">        <h4>Customer information</h4>        <div class="form-row">          <div class="form-group">            <label>Customer</label>            <select v-model="formData.user_id" class="form-select">              <option value="">Walk-in customer</option>              <option v-for="customer in customers" :key="customer.id" :value="customer.id">                {{ customer.name }} - {{ customer.phone }}              </option>            </select>          </div>          <div class="form-group">            <label>Customer name</label>            <input               v-model="formData.customer_name"               type="text"               class="form-input"              placeholder="Enter customer name"            />          </div>        </div>        <div class="form-row">          <div class="form-group">            <label>Phone number</label>            <input               v-model="formData.customer_phone"               type="tel"               class="form-input"              placeholder="Enter phone number"            />          </div>          <div class="form-group">            <label>Order type</label>            <select v-model="formData.order_type" class="form-select" required>              <option value="dine_in">Dine-in</option>              <option value="takeaway">Takeaway</option>              <option value="delivery">Delivery</option>            </select>          </div>        </div>      </div>      <div class="form-section">        <h4>Branch & Table</h4>        <div class="form-row">          <div class="form-group">            <label>Branch</label>            <select v-model="formData.branch_id" class="form-select" required @change="loadTables">              <option value="">Select branch</option>              <option v-for="branch in branches" :key="branch.id" :value="branch.id">                {{ branch.name }}              </option>            </select>          </div>          <div v-if="formData.order_type === 'dine_in'" class="form-group">            <label>Table</label>            <select v-model="formData.table_id" class="form-select">              <option value="">Select table</option>              <option v-for="table in availableTables" :key="table.id" :value="table.id">                #{{ table.id }} ({{ table.capacity }} guests)              </option>            </select>          </div>        </div>      </div>      <div class="form-section">        <h4>Products</h4>        <div class="product-selector">          <div class="product-search">            <input               v-model="productSearch"               type="text"               placeholder="Search products..."              class="form-input"              @input="searchProducts"            />          </div>          <div v-if="productsLoading" class="loading">Loading...</div>          <div v-else class="products-grid">            <div               v-for="product in filteredProducts"               :key="product.id"              class="product-card"              @click="addProduct(product)"            >              <img                 :src="product.image || '/images/default-product.png'"                 :alt="product.name"                class="product-image"              />              <div class="product-info">                <h5>{{ product.name }}</h5>                <p class="product-price">{{ formatCurrency(product.price) }}</p>              </div>            </div>          </div>        </div>        <div class="cart-section">          <h5>Cart ({{ cartItems.length }})</h5>          <div v-if="cartItems.length === 0" class="empty-cart">            <p>No products yet</p>          </div>          <div v-else class="cart-items">            <div               v-for="(item, index) in cartItems"               :key="index"              class="cart-item"            >              <div class="item-info">                <span class="item-name">{{ item.name }}</span>                <span class="item-price">{{ formatCurrency(item.price * item.quantity) }}</span>              </div>              <div class="item-actions">                <button                   type="button"                  class="btn btn-sm btn-secondary"                   @click="decreaseQuantity(index)"                >                  <i class="fas fa-minus"></i>                </button>                <span class="quantity">{{ item.quantity }}</span>                <button                   type="button"                  class="btn btn-sm btn-secondary"                   @click="increaseQuantity(index)"                >                  <i class="fas fa-plus"></i>                </button>                <button                   type="button"                  class="btn btn-sm btn-danger"                   @click="removeItem(index)"                >                  <i class="fas fa-trash"></i>                </button>              </div>            </div>          </div>          <div class="cart-summary">            <div class="summary-row">              <span>Subtotal:</span>              <span>{{ formatCurrency(subtotal) }}</span>            </div>            <div class="summary-row">              <span>Discount:</span>              <span class="discount">-{{ formatCurrency(discount) }}</span>            </div>            <div class="summary-row total">              <span>Total:</span>              <span>{{ formatCurrency(total) }}</span>            </div>          </div>        </div>      </div>      <div class="form-section">        <h4>Notes</h4>        <textarea           v-model="formData.notes"           class="form-textarea"           rows="3"          placeholder="Special notes..."        ></textarea>      </div>      <div class="form-actions">        <button type="button" class="btn btn-secondary" @click="$emit('cancel')">          Cancel        </button>        <button           type="submit"           class="btn btn-primary"           :disabled="submitting || cartItems.length === 0"        >          <i class="fas fa-check"></i> Create order        </button>      </div>    </form>  </div></template><script setup>import { ref, reactive, computed, watch } from 'vue';import { useToast } from 'vue-toastification';import ProductService from '@/services/ProductService';import BranchService from '@/services/BranchService';import TableService from '@/services/TableService';import UserService from '@/services/UserService';import OrderService from '@/services/OrderService';const emit = defineEmits(['order-created', 'cancel']);const toast = useToast();const formData = reactive({  user_id: '',  customer_name: '',  customer_phone: '',  branch_id: '',  table_id: '',  order_type: 'dine_in',  notes: ''});const branches = ref([]);const customers = ref([]);const availableTables = ref([]);const products = ref([]);const productsLoading = ref(false);const productSearch = ref('');const cartItems = ref([]);const submitting = ref(false);const filteredProducts = computed(() => {  if (!productSearch.value) return products.value;  const search = productSearch.value.toLowerCase();  return products.value.filter(p =>     p.name.toLowerCase().includes(search)  );});const subtotal = computed(() => {  return cartItems.value.reduce((sum, item) => sum + (item.price * item.quantity), 0);});const total = computed(() => {  return subtotal.value;});async function loadBranches() {  try {    const data = await BranchService.getAllBranches();    branches.value = data.branches || data.items || data.data || [];  } catch (error) {    }}async function loadCustomers() {  try {    const data = await UserService.getAllUsers({ role_id: 4 });     customers.value = data.users || data.items || data.data || [];  } catch (error) {    try {      const data = await UserService.getUsers(1, 100, { role_id: 4 });      customers.value = data.users || data.items || data.data || [];    } catch (err) {      }  }}async function loadTables() {  if (!formData.branch_id) return;  try {    const data = await TableService.getAvailableTables({ branch_id: formData.branch_id });    availableTables.value = data.tables || data.items || data.data || [];  } catch (error) {    }}async function loadProducts() {  if (!formData.branch_id) return;  productsLoading.value = true;  try {    const data = await ProductService.getAvailableProducts({       branch_id: formData.branch_id     });    products.value = data.products || data.items || data.data || [];  } catch (error) {    toast.error('Failed to load products');  } finally {    productsLoading.value = false;  }}watch(() => formData.branch_id, () => {  if (formData.branch_id) {    loadProducts();    loadTables();  }});function addProduct(product) {  const existingItem = cartItems.value.find(item => item.id === product.id);  if (existingItem) {    existingItem.quantity++;  } else {    cartItems.value.push({      id: product.id,      name: product.name,      price: product.price,      quantity: 1    });  }}function increaseQuantity(index) {  cartItems.value[index].quantity++;}function decreaseQuantity(index) {  if (cartItems.value[index].quantity > 1) {    cartItems.value[index].quantity--;  } else {    removeItem(index);  }}function removeItem(index) {  cartItems.value.splice(index, 1);}async function submitOrder() {  if (cartItems.value.length === 0) {    toast.error('Please add products to cart');    return;  }  submitting.value = true;  try {    const cartData = {      user_id: formData.user_id || null,      branch_id: formData.branch_id,      table_id: formData.table_id || null,      order_type: formData.order_type,      items: cartItems.value.map(item => ({        product_id: item.id,        quantity: item.quantity,        price: item.price      })),      total: total.value,      subtotal: subtotal.value,      discount: 0,      notes: formData.notes    };    const orderData = {      id: Date.now(),      user_id: formData.user_id || null,      customer_name: formData.customer_name || null,      customer_phone: formData.customer_phone || null,      branch_id: formData.branch_id,      table_id: formData.table_id || null,      order_type: formData.order_type,      total: total.value,      subtotal: subtotal.value,      discount: 0,      status: 'pending',      payment_status: 'pending',      notes: formData.notes,      items: cartItems.value,      created_at: new Date().toISOString()    };    toast.success('Order created successfully');    emit('order-created', orderData);    resetForm();  } catch (error) {    toast.error('Failed to create order');  } finally {    submitting.value = false;  }}function resetForm() {  formData.user_id = '';  formData.customer_name = '';  formData.customer_phone = '';  formData.branch_id = '';  formData.table_id = '';  formData.order_type = 'dine_in';  formData.notes = '';  cartItems.value = [];}function formatCurrency(amount) {  return new Intl.NumberFormat('vi-VN', {    style: 'currency',    currency: 'VND'  }).format(amount);}loadBranches();loadCustomers();</script><style scoped>.create-order-form {  max-width: 100%;}.form-section {  margin-bottom: 24px;  padding-bottom: 24px;  border-bottom: 1px solid #E2E8F0;}.form-section:last-child {  border-bottom: none;}.form-section h4 {  font-size: 16px;  margin-bottom: 16px;  color: #333;}.form-row {  display: grid;  grid-template-columns: 1fr 1fr;  gap: 16px;}.form-group {  margin-bottom: 16px;}.form-group label {  display: block;  margin-bottom: 6px;  font-weight: 500;  color: #333;}.form-select,.form-input,.form-textarea {  width: 100%;  padding: 8px 12px;  border: 1px solid #E2E8F0;  border-radius: 4px;  font-size: 14px;}.product-selector {  margin-bottom: 24px;}.product-search {  margin-bottom: 16px;}.products-grid {  display: grid;  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));  gap: 12px;  max-height: 300px;  overflow-y: auto;  padding: 12px;  background: #F8F9FA;  border-radius: 4px;}.product-card {  background: white;  border: 1px solid #E2E8F0;  border-radius: 8px;  padding: 12px;  cursor: pointer;  transition: all 0.3s;  text-align: center;}.product-card:hover {  border-color: #007bff;  box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);}.product-image {  width: 100%;  height: 100px;  object-fit: cover;  border-radius: 4px;  margin-bottom: 8px;}.product-info h5 {  font-size: 14px;  margin: 0 0 4px 0;  color: #333;}.product-price {  font-size: 14px;  font-weight: 600;  color: #007bff;  margin: 0;}.cart-section {  background: #F8F9FA;  padding: 16px;  border-radius: 8px;}.cart-section h5 {  font-size: 16px;  margin-bottom: 12px;  color: #333;}.empty-cart {  text-align: center;  padding: 20px;  color: #999;}.cart-items {  margin-bottom: 16px;}.cart-item {  display: flex;  justify-content: space-between;  align-items: center;  padding: 12px;  background: white;  border-radius: 4px;  margin-bottom: 8px;}.item-info {  flex: 1;}.item-name {  display: block;  font-weight: 500;  color: #333;  margin-bottom: 4px;}.item-price {  display: block;  color: #007bff;  font-weight: 600;}.item-actions {  display: flex;  align-items: center;  gap: 8px;}.quantity {  min-width: 30px;  text-align: center;  font-weight: 500;}.cart-summary {  border-top: 2px solid #E2E8F0;  padding-top: 12px;}.summary-row {  display: flex;  justify-content: space-between;  margin-bottom: 8px;  font-size: 14px;}.summary-row.total {  font-size: 18px;  font-weight: 600;  color: #333;  margin-top: 8px;  padding-top: 8px;  border-top: 1px solid #E2E8F0;}.discount {  color: #28A745;}.form-actions {  display: flex;  justify-content: flex-end;  gap: 12px;  margin-top: 24px;}.btn {  padding: 10px 20px;  border: none;  border-radius: 4px;  cursor: pointer;  font-size: 14px;  transition: all 0.3s;}.btn-primary {  background: #007bff;  color: white;}.btn-primary:hover:not(:disabled) {  background: #0056b3;}.btn-primary:disabled {  opacity: 0.6;  cursor: not-allowed;}.btn-secondary {  background: #6C757D;  color: white;}.btn-secondary:hover {  background: #5A6268;}.btn-danger {  background: #DC3545;  color: white;}.btn-danger:hover {  background: #C82333;}.btn-sm {  padding: 6px 12px;  font-size: 12px;}.loading {  text-align: center;  padding: 20px;  color: #999;}</style>