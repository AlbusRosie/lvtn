<script setup>import { ref, computed, onMounted, watch } from 'vue';import { Bar } from 'vue-chartjs';import {  Chart as ChartJS,  CategoryScale,  LinearScale,  BarElement,  Title,  Tooltip,  Legend,  Filler} from 'chart.js';import OrderService from '@/services/OrderService';ChartJS.register(  CategoryScale,  LinearScale,  BarElement,  Title,  Tooltip,  Legend,  Filler);const props = defineProps({  filters: {    type: Object,    default: () => ({})  },  period: {    type: String,    default: 'week'  }});const emit = defineEmits(['data-loaded']);const ordersData = ref([]);const loading = ref(false);const chartData = computed(() => {  if (!ordersData.value || ordersData.value.length === 0) {    return {      labels: [],      datasets: []    };  }  const labels = ordersData.value.map(item => item.label);  const data = ordersData.value.map(item => item.count);  return {    labels,    datasets: [{      label: 'Tổng đơn hàng',      data,      backgroundColor: 'rgba(255, 184, 0, 0.7)',      borderColor: '#FFB800',      borderWidth: 1,      maxBarThickness: 28,      categoryPercentage: 0.6,      barPercentage: 0.9    }]  };});const chartOptions = computed(() => ({  responsive: true,  maintainAspectRatio: false,  plugins: {    legend: {      display: false    },    tooltip: {      mode: 'nearest',      intersect: true,      backgroundColor: 'rgba(0, 0, 0, 0.8)',      titleColor: 'white',      bodyColor: 'white',      borderColor: 'rgba(255, 255, 255, 0.1)',      borderWidth: 1,      cornerRadius: 8,      displayColors: true    }  },  scales: {    x: {      display: true,      grid: {        display: false      },      grid: {        display: false      },      ticks: {        font: {          size: 10        },        color: '#6c757d'      }    },    y: {      display: true,      grid: {        color: 'rgba(0, 0, 0, 0.05)',        drawBorder: false      },      ticks: {        font: {          size: 10        },        color: '#6c757d',        stepSize: 1      }    }  },  interaction: {    mode: 'nearest',    axis: 'x',    intersect: true  },  elements: {}}));async function loadOrdersData() {  loading.value = true;  try {    const now = new Date();    let startDate;    let labels = [];    switch (props.period) {      case 'day':        startDate = new Date(now);        startDate.setDate(startDate.getDate() - 6);         labels = Array.from({ length: 7 }, (_, i) => {          const d = new Date(startDate);          d.setDate(d.getDate() + i);          return d.toLocaleDateString('vi-VN', { weekday: 'short' });        });        break;      case 'week':        startDate = new Date(now);        startDate.setDate(startDate.getDate() - (7 * 6));         labels = Array.from({ length: 7 }, (_, i) => {          const d = new Date(startDate);          d.setDate(d.getDate() + (i * 7));          return `Tuần ${i + 1}`;        });        break;      case 'month':        startDate = new Date(now.getFullYear(), now.getMonth() - 5, 1);         labels = Array.from({ length: 6 }, (_, i) => {          const d = new Date(startDate);          d.setMonth(d.getMonth() + i);          return `Tháng ${d.getMonth() + 1}`;        });        break;      case 'year':        startDate = new Date(now.getFullYear() - 5, 0, 1);         labels = Array.from({ length: 6 }, (_, i) => {          return `${now.getFullYear() - 5 + i}`;        });        break;    }    const filters = {      ...props.filters,      date_from: startDate.toISOString().split('T')[0],      limit: 1000    };    const result = await OrderService.getAllOrders(filters);    const orders = result.orders || [];    const grouped = labels.map((label, index) => {      let periodStart, periodEnd;      switch (props.period) {        case 'day':          periodStart = new Date(startDate);          periodStart.setDate(periodStart.getDate() + index);          periodEnd = new Date(periodStart);          periodEnd.setDate(periodEnd.getDate() + 1);          break;        case 'week':          periodStart = new Date(startDate);          periodStart.setDate(periodStart.getDate() + (index * 7));          periodEnd = new Date(periodStart);          periodEnd.setDate(periodEnd.getDate() + 7);          break;        case 'month':          periodStart = new Date(startDate);          periodStart.setMonth(periodStart.getMonth() + index);          periodEnd = new Date(periodStart);          periodEnd.setMonth(periodEnd.getMonth() + 1);          break;        case 'year':          periodStart = new Date(now.getFullYear() - 5 + index, 0, 1);          periodEnd = new Date(now.getFullYear() - 5 + index + 1, 0, 1);          break;      }      const count = orders.filter(order => {        const orderDate = new Date(order.created_at);        return orderDate >= periodStart && orderDate < periodEnd;      }).length;      return { label, count };    });    ordersData.value = grouped;    emit('data-loaded', grouped);  } catch (error) {    ordersData.value = [];  } finally {    loading.value = false;  }}onMounted(() => {  loadOrdersData();});watch(() => [props.filters, props.period], () => {  loadOrdersData();}, { deep: true });</script><template>  <div class="orders-chart">    <div v-if="loading" class="chart-loading">      <div class="spinner"></div>      <p>Đang tải dữ liệu...</p>    </div>    <div v-else-if="!chartData.labels || chartData.labels.length === 0" class="chart-empty">      <i class="fas fa-chart-line"></i>      <p>Không có dữ liệu để hiển thị</p>    </div>    <div v-else class="chart-wrapper">      <Bar         :data="chartData"         :options="chartOptions"      />    </div>  </div></template><style scoped>.orders-chart {  width: 100%;  height: 100%;}.chart-loading,.chart-empty {  display: flex;  flex-direction: column;  align-items: center;  justify-content: center;  height: 100%;  color: #6c757d;}.spinner {  width: 30px;  height: 30px;  border: 3px solid #f3f3f3;  border-top: 3px solid #FF8C42;  border-radius: 50%;  animation: spin 1s linear infinite;  margin-bottom: 12px;}@keyframes spin {  0% { transform: rotate(0deg); }  100% { transform: rotate(360deg); }}.chart-empty i {  font-size: 2rem;  margin-bottom: 12px;  color: #9ca3af;}.chart-empty p {  margin: 0;  font-size: 12px;}.chart-wrapper {  height: 100%;  width: 100%;}</style>